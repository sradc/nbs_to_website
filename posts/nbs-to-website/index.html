
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test page</title>
    <link rel="stylesheet" href="../../stylesheet.css">
    <script src="../../script.js"></script>
    
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ],
        displayMath: [ ['$$','$$'], ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true }
    }
});
</script>

  </head>
  <body>
    <div class="notebook"><div class="markdown"><h1>This Jupyter Notebook generates this website.</h1>
</div><br><div class="markdown"><p>I wanted to be able to generate my website from a collection of Jupyter Notebooks.
There's already tools for this...
But, I thought it would be fun if the site was generated from one of its own notebooks.
This is that notebook.</p>
<p>This is a kind of messy work in progress...</p>
<p>My workflow when making changes here is to then run:</p>
<pre><code class="language-bash">bash _scripts/build-site.sh &amp;&amp; python -m http.server
</code></pre>
<p>... to generate and serve the site.</p>
<p>Some things this notebook does:</p>
<ul>
<li>Parse the Jupyter Notebooks.</li>
<li>Get the text content of markdown/code cells.</li>
<li>Get the text output or image output of cells.</li>
<li>Enable &quot;cell parameters&quot;, e.g. for flagging when to hide cells, etc.</li>
<li>Generate html</li>
<li>Use <code>pygments</code> to convert code to highlighted html</li>
<li>Use <code>marko</code> to convert the markdown to html</li>
<li>Convert the base64 string images into images, to enable caching/faster page loading.</li>
<li>Generates style/homepage/...</li>
</ul>
<p>Requirements:</p>
<pre><code>markdown=3.3.6
pygments=2.11.2
tqdm=4.62.3
</code></pre>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">marko</span> <span class="kn">import</span> <span class="n">convert</span> <span class="k">as</span> <span class="n">markdown</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">pygments</span> <span class="kn">import</span> <span class="n">formatters</span><span class="p">,</span> <span class="n">lexers</span><span class="p">,</span> <span class="n">highlight</span>
<span class="kn">from</span> <span class="nn">pygments.styles</span> <span class="kn">import</span> <span class="n">STYLE_MAP</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">IMG_NAME_HASH_LEN</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># use first `IMG_NAME_HASH_LEN` of hash for filename</span>

<span class="n">python_lexer</span> <span class="o">=</span> <span class="n">lexers</span><span class="o">.</span><span class="n">PythonLexer</span><span class="p">()</span>
<span class="n">text_lexer</span> <span class="o">=</span> <span class="n">lexers</span><span class="o">.</span><span class="n">TextLexer</span><span class="p">()</span>
<span class="n">html_formatter</span> <span class="o">=</span> <span class="n">formatters</span><span class="o">.</span><span class="n">HtmlFormatter</span><span class="p">(</span><span class="n">linenos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
</pre></div>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">STYLE_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div><div class="outputs"><div class="outtext"><div class="highlight"><pre><span></span>dict_keys([&#39;default&#39;, &#39;emacs&#39;, &#39;friendly&#39;, &#39;friendly_grayscale&#39;, &#39;colorful&#39;, &#39;autumn&#39;, &#39;murphy&#39;, &#39;manni&#39;, &#39;material&#39;, &#39;monokai&#39;, &#39;perldoc&#39;, &#39;pastie&#39;, &#39;borland&#39;, &#39;trac&#39;, &#39;native&#39;, &#39;fruity&#39;, &#39;bw&#39;, &#39;vim&#39;, &#39;vs&#39;, &#39;tango&#39;, &#39;rrt&#39;, &#39;xcode&#39;, &#39;igor&#39;, &#39;paraiso-light&#39;, &#39;paraiso-dark&#39;, &#39;lovelace&#39;, &#39;algol&#39;, &#39;algol_nu&#39;, &#39;arduino&#39;, &#39;rainbow_dash&#39;, &#39;abap&#39;, &#39;solarized-dark&#39;, &#39;solarized-light&#39;, &#39;sas&#39;, &#39;stata&#39;, &#39;stata-light&#39;, &#39;stata-dark&#39;, &#39;inkpot&#39;, &#39;zenburn&#39;, &#39;gruvbox-dark&#39;, &#39;gruvbox-light&#39;, &#39;dracula&#39;, &#39;one-dark&#39;, &#39;lilypond&#39;])
</pre></div>
</div></div><br><div class="code"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># if running as a script</span>
    <span class="n">nb_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># if running as a Jupyter Notebook</span>
    <span class="n">nb_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

<span class="n">WEBSITE_DIR</span> <span class="o">=</span> <span class="n">nb_dir</span><span class="o">.</span><span class="n">parent</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">WEBSITE_DIR</span> <span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div><div class="outputs"><div class="outtext"><div class="highlight"><pre><span></span>WEBSITE_DIR = PosixPath(&#39;/Users/sidneyradcliffe/repos/nbs-to-website&#39;)
</pre></div>
</div></div><br><div class="markdown"><h3>Cell parameters</h3>
<p>Make it possible to put parameters in the Jupyter Notebook cells, that can be looked at when building the website.</p>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_cell_flag</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get parameters in Jupyter cells, that are comments in the form:</span>

<span class="sd">    # {{my_flag}}</span>
<span class="sd">    # {{my_key=my_value}}</span>
<span class="sd">    x = 4</span>
<span class="sd">    # {{foo=bar}}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^# \{\{.+\}\}&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)</span>  <span class="c1"># remove &#39;{{&#39;/&#39;}}&#39; from the strings</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid param length, &#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="si">= }</span><span class="s2">&#39;, </span><span class="si">{</span><span class="n">x</span> <span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">example</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;# {{my_flag}}</span>
<span class="s2"># {{my_key=my_value}}</span>
<span class="s2">This is a simulation of a ipynb cell.</span>
<span class="s2"># {{foo=bar}}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_cell_flag</span><span class="p">(</span><span class="n">example</span><span class="p">))</span>
</pre></div>
</div><div class="outputs"><div class="outtext"><div class="highlight"><pre><span></span>{&#39;my_flag&#39;: True, &#39;my_key&#39;: &#39;my_value&#39;, &#39;foo&#39;: &#39;bar&#39;}
</pre></div>
</div></div><br><div class="markdown"><h3>Parsing the notebook</h3>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nb_to_html</span><span class="p">(</span><span class="n">nb_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">post_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">nb_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">nb_path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
    <span class="n">cells_as_html</span> <span class="o">=</span> <span class="p">(</span><span class="n">cell_to_html</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">post_dir</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">nb_data</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">])</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cells_as_html</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;notebook&quot;&gt;</span><span class="si">{</span><span class="n">html</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span>


<span class="k">def</span> <span class="nf">cell_to_html</span><span class="p">(</span><span class="n">cell</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">post_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="s2">&quot;cell_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;markdown&quot;</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;markdown&quot;&gt;</span><span class="si">{</span><span class="n">markdown</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cell</span><span class="p">[</span><span class="s2">&quot;cell_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;code&quot;</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;&lt;div class=&quot;code&quot;&gt;&#39;</span>
            <span class="o">+</span> <span class="n">highlight</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">python_lexer</span><span class="p">,</span> <span class="n">html_formatter</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outputs</span> <span class="o">:=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell_outputs_to_html</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="s2">&quot;outputs&quot;</span><span class="p">],</span> <span class="n">post_dir</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;outputs&quot;&gt;</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">)</span>

    <span class="n">cell_flag</span> <span class="o">=</span> <span class="n">get_cell_flag</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">cell_outputs_to_html</span><span class="p">(</span><span class="n">cell_outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">post_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cell_output</span> <span class="ow">in</span> <span class="n">cell_outputs</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">cell_output</span><span class="p">[</span><span class="s2">&quot;output_type&quot;</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s2">&quot;stream&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span> <span class="o">:=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cell_output</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_lexer</span><span class="p">,</span> <span class="n">html_formatter</span><span class="p">)</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;outtext&quot;&gt;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;display_data&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">imdata</span> <span class="o">:=</span> <span class="n">cell_output</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;image/png&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">imdata</span> <span class="o">=</span> <span class="n">imdata</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">hash</span><span class="p">[:</span><span class="n">IMG_NAME_HASH_LEN</span><span class="p">]</span><span class="si">}</span><span class="s2">.png&quot;</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">post_dir</span> <span class="o">/</span> <span class="n">fname</span>
                    <span class="n">file_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">decodebytes</span><span class="p">(</span><span class="n">imdata</span><span class="p">))</span>
                    <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
                        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;./</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot; width=&quot;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s1">&quot; height=&quot;</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s1">&quot; class=&quot;out_img&quot;/&gt;&#39;</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
            <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="n">mathjax</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;script type=&quot;text/javascript&quot; async</span>
<span class="s2">  src=&quot;https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML&quot;&gt;</span>
<span class="s2">&lt;/script&gt;</span>

<span class="s2">&lt;!-- MathJax configuration --&gt;</span>
<span class="s2">&lt;script type=&quot;text/x-mathjax-config&quot;&gt;</span>
<span class="s2">MathJax.Hub.Config({</span>
<span class="s2">    tex2jax: {</span>
<span class="s2">        inlineMath: [ [&#39;$&#39;,&#39;$&#39;], ],</span>
<span class="s2">        displayMath: [ [&#39;$$&#39;,&#39;$$&#39;], ],</span>
<span class="s2">        processEscapes: true,</span>
<span class="s2">        processEnvironments: true</span>
<span class="s2">    },</span>
<span class="s2">    // Center justify equations in code and markdown cells. Elsewhere</span>
<span class="s2">    // we use CSS to left justify single line equations in code cells.</span>
<span class="s2">    displayAlign: &#39;center&#39;,</span>
<span class="s2">    &quot;HTML-CSS&quot;: {</span>
<span class="s2">        styles: {&#39;.MathJax_Display&#39;: {&quot;margin&quot;: 0}},</span>
<span class="s2">        linebreaks: { automatic: true }</span>
<span class="s2">    }</span>
<span class="s2">});</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">style</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">html_formatter</span><span class="o">.</span><span class="n">get_style_defs</span><span class="p">(</span><span class="s2">&quot;.highlight&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">.code, .markdown, .outputs {</span>
<span class="s2">  margin: auto;</span>
<span class="s2">  padding: 4px 4px 4px 8px;</span>
<span class="s2">  box-sizing: border-box;</span>
<span class="s2">}</span>
<span class="s2">.markdown {</span>
<span class="s2">  max-width: 600px;</span>
<span class="s2">}</span>
<span class="s2">.code, .outputs {</span>
<span class="s2">  max-width: 720px;</span>
<span class="s2">  overflow: auto;</span>
<span class="s2">}</span>
<span class="s2">.code {</span>
<span class="s2">  background-color: #F8F8F8;</span>
<span class="s2">  /*box-shadow: inset 3px 3px 4px 3px #F0F0F0;*/</span>
<span class="s2">}</span>
<span class="s2">.outputs {</span>
<span class="s2">  /*</span>
<span class="s2">  box-shadow: inset 0px 0px 1px 4px #F8F8F8;</span>
<span class="s2">  background-color: lightgray;</span>
<span class="s2">  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAAAAABX3VL4AAAADklEQVQI12P4/5/hPwMACvsC/tmfKMUAAAAASUVORK5CYII=);</span>
<span class="s2">  */</span>
<span class="s2">  box-shadow: inset 4px -4px 0px #F0F0F0;</span>
<span class="s2">  border: 6px solid #F8F8F8;</span>
<span class="s2">}</span>
<span class="s2">.notebook {</span>
<span class="s2">  font-family: sans-serif;</span>
<span class="s2">}</span>
<span class="s2">.code *, .outputs *, code {</span>
<span class="s2">  font-family: monospace;</span>
<span class="s2">  background-color: rgba(0,0,0,0);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div><br><div class="markdown"><h3>Site directory structure:</h3>
<pre><code>index.html
stylesheet.css
script.js
posts/
    notebook_1/
        index.html
        image_1.jpg
        image_2.jpg
    notebook_2/
        index.html
        image_1.jpg
</code></pre>
<p>To serve:</p>
<pre><code class="language-bash">python -m http.server
</code></pre>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="n">root</span> <span class="o">=</span> <span class="n">WEBSITE_DIR</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">mkdir</span><span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;posts/&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;stylesheet.css&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>

<span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;script.js&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">console.log(&quot;hi from my script&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div><br><div class="code"><div class="highlight"><pre><span></span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nb_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.ipynb&quot;</span><span class="p">))):</span>
    <span class="n">post_dir</span> <span class="o">=</span> <span class="n">mkdir</span><span class="p">(</span><span class="n">posts</span> <span class="o">/</span> <span class="n">notebook</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
    <span class="p">(</span><span class="n">post_dir</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s2">  &lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="s2">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="s2">    &lt;title&gt;Test page&lt;/title&gt;</span>
<span class="s2">    &lt;link rel=&quot;stylesheet&quot; href=&quot;../../stylesheet.css&quot;&gt;</span>
<span class="s2">    &lt;script src=&quot;../../script.js&quot;&gt;&lt;/script&gt;</span>
<span class="s2">    </span><span class="si">{</span><span class="n">mathjax</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  &lt;/head&gt;</span>
<span class="s2">  &lt;body&gt;</span>
<span class="s2">    </span><span class="si">{</span><span class="n">nb_to_html</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="n">post_dir</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">post_dir</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>

<span class="n">links</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;./</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;/a&gt;&lt;/li&gt;&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">links</span><span class="p">)</span>
<span class="n">home_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">body {</span>
<span class="s2">  margin: auto;</span>
<span class="s2">  max-width: 600px;</span>
<span class="s2">  font-family: sans-serif;</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s2">  &lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="s2">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="s2">    &lt;title&gt;sid&#39;s site&lt;/title&gt;</span>
<span class="s2">    &lt;link rel=&quot;stylesheet&quot; href=&quot;./stylesheet.css&quot;&gt;</span>
<span class="s2">    &lt;script src=&quot;./script.js&quot;&gt;&lt;/script&gt;</span>
<span class="s2">  &lt;/head&gt;</span>
<span class="s2">  &lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Sid&#39;s site&lt;/h1&gt;</span>
<span class="s2">    &lt;h2&gt;Posts&lt;/h2&gt;</span>
<span class="s2">    &lt;ul&gt;</span><span class="si">{</span><span class="n">links</span><span class="si">}</span><span class="s2">&lt;/ul&gt;</span>
<span class="s2">  &lt;/body&gt;</span>
<span class="s2">  &lt;style&gt;</span><span class="si">{</span><span class="n">home_style</span><span class="si">}</span><span class="s2">&lt;/style&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div><div class="outputs"><div class="outtext"><div class="highlight"><pre><span></span>100%|██████████| 2/2 [00:00&lt;00:00, 92.89it/s]
</pre></div>
</div></div><br></div>
  </body>
</html>
    